<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snappiko – 실시간 AI 주식/코인 정보</title>

  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'deep-navy':  '#0A1929',
            'midnight':   '#050A14',
            'accent-blue':'#3B82F6',
            'card-bg':    '#0F172A',
            'positive':   '#10B981',
            'negative':   '#EF4444',
            'neutral':    '#6B7280',
            'condition-a':'#3B82F6',
            'condition-b':'#8B5CF6',
            'condition-c':'#EC4899',
            'condition-d':'#F59E0B',
            'condition-e':'#10B981',
            'bright-green': '#4ade80', // NEW 플래그를 위한 밝은 녹색 (green-400)
          },
          boxShadow: {
            'soft':'0 4px 12px rgba(0,0,0,0.15)'
          }
        }
      }
    };
  </script>

  <style>
    body { font-family: 'Noto Sans KR', sans-serif; background: linear-gradient(to bottom, #0A1929, #050A14); color: #E5E7EB; }
    .ticker-wrapper { display: inline-block; animation: ticker 30s linear infinite; }
    .ticker-item { display: inline-block; padding: 0 1.5rem; }
    @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
    @media (max-width: 768px) { .ticker-wrapper { animation: ticker 15s linear infinite; } }
    .confidence-bar-bg { height: 6px; border-radius: 3px; background: rgba(255,255,255,.1); overflow: hidden; }
    .confidence-bar-fill { height: 100%; border-radius: 3px; background: linear-gradient(90deg, #3B82F6, #60A5FA); }
    .tab-active { border-bottom: 2px solid #3B82F6; color: #fff !important; }
    .stock-card { transition: all .2s ease; }
    .stock-card:hover { transform: translateY(-4px); box-shadow: 0 8px 16px rgba(0,0,0,.2); }
    .favorite-star { transition: all .2s ease; }
    .favorite-star.active { color: #F59E0B; transform: scale(1.2); }
    .notification-toggle { position: relative; width: 48px; height: 24px; }
    .notification-toggle input { opacity: 0; width: 0; height: 0; }
    .notification-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #374151; transition: .4s; border-radius: 24px; }
    .notification-slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .notification-slider { background-color: #3B82F6; }
    input:checked + .notification-slider:before { transform: translateX(24px); }
    .stock-update { animation: pulse 2s infinite; }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: .6; } 100% { opacity: 1; } }
    .condition-badge { font-size: .7rem; padding: .15rem .4rem; border-radius: 4px; margin-right: .5rem; font-weight: 500; }
    .filter-btn { background: rgba(107,114,128,.2); color: #9CA3AF; }
    .filter-btn.active { background: rgba(59,130,246,.2); color: #3B82F6; }
    .metric-box { display: flex; justify-content: space-between; align-items: center; font-size: .825rem; background: rgba(255,255,255,.05); border-radius: 4px; padding: .35rem .5rem; }
    .metric-label { color: #A1A1AA; }
    .metric-value { font-weight: 500; }
    .post-card { border-bottom: 1px solid rgba(255,255,255,.05); padding-bottom: 1.25rem; margin-bottom: 1.25rem; }
    .post-card:last-child { border-bottom: none; margin-bottom: 0; }
    .post-header { display: flex; justify-content: space-between; align-items: center; }
    .forum-badge { font-size: .75rem; background: #374151; padding: .15rem .5rem; border-radius: .25rem; display: inline-flex; align-items: center; }
    .like-btn { cursor: pointer; transition: all .2s ease; } /* 좋아요 버튼 전체에 transition 적용 */
    .like-btn:hover { background-color: #4A5568; }
    .like-btn.liked svg { fill: #3B82F6; stroke: #3B82F6; color: #3B82F6;} /* 좋아요 눌렸을 때 SVG 색상 변경 */
    .like-btn.liked span { color: #60A5FA; } /* 좋아요 눌렸을 때 숫자 색상 변경 */

    .category-tab-btn { transition: color .2s ease, border-color .2s ease; }
    .main-nav-link.active { color: #E5E7EB; background-color: rgba(59, 130, 246, 0.3); }
    .main-nav-link { color: #9CA3AF; }
    .main-nav-link:hover { background-color: rgba(55, 65, 81, 0.7); color: #E5E7EB; }
    .modal-input { appearance: none; border-radius: 0.375rem; border: 1px solid #4B5563; background-color: #1F2937; padding: 0.5rem 0.75rem; color: white; }
    .modal-input::placeholder { color: #6B7280; }
    .modal-input:focus { outline: none; ring-width: 1px; ring-color: #3B82F6; border-color: #3B82F6; }
    .feedback-success { color: #10B981; }
    .feedback-error { color: #EF4444; }
  </style>
</head>
<body class="min-h-screen pb-12">

  <header class="sticky top-0 z-50 bg-deep-navy/95 backdrop-blur-sm shadow-md">
    <div class="container mx-auto flex items-center justify-between px-4 py-3">
      <div class="flex items-center flex-shrink-0"> <svg class="w-7 h-7 sm:w-8 sm:h-8 text-accent-blue" fill="currentColor" viewBox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/><path d="M16 10h2V4h-2v6zm0 10h2v-6h-2v6z"/></svg>
        <span class="ml-1.5 sm:ml-2 text-lg sm:text-xl font-bold text-white flex-shrink-0">Snappiko</span>
        <nav id="main-navigation" class="ml-2 sm:ml-4 md:ml-6 flex items-baseline space-x-1 sm:space-x-2">
            <a href="#stocks" id="nav-stocks" class="main-nav-link active px-1.5 py-1 sm:px-3 sm:py-2 rounded-md text-xs sm:text-sm font-medium whitespace-nowrap" aria-current="page">주식</a>
            <a href="#coins" id="nav-coins" class="main-nav-link px-1.5 py-1 sm:px-3 sm:py-2 rounded-md text-xs sm:text-sm font-medium whitespace-nowrap">코인</a>
        </nav>
      </div>
      <div class="flex items-center flex-shrink-0"> <span class="mr-1.5 sm:mr-2 text-xs sm:text-sm hidden md:inline">알림</span>
        <label class="notification-toggle mr-2 sm:mr-4">
          <input type="checkbox" id="notification-toggle" checked>
          <span class="notification-slider"></span>
        </label>
        <div id="auth-container" class="flex items-center">
            <button id="signup-btn-header" class="text-xs sm:text-sm text-gray-300 hover:text-white transition focus:outline-none mr-1.5 sm:mr-3 whitespace-nowrap">회원가입</button>
            <button id="login-btn-header" class="text-xs sm:text-sm text-gray-300 hover:text-white transition focus:outline-none whitespace-nowrap">로그인</button>
            <span id="welcome-message" class="text-xs sm:text-sm text-gray-300 mr-1.5 sm:mr-3 hidden whitespace-nowrap"></span>
            <button id="logout-btn-header" class="text-xs sm:text-sm text-gray-300 hover:text-white transition focus:outline-none hidden whitespace-nowrap">로그아웃</button>
        </div>
      </div>
    </div>
  </header>

  <div id="stock-service-content">
    <section class="bg-deep-navy border-b border-gray-800 py-3">
      <div class="container mx-auto flex items-center justify-between px-4">
        <div class="ticker-container flex-1 overflow-hidden whitespace-nowrap">
          <div class="ticker-wrapper" id="ticker-wrapper-1"></div>
          <div class="ticker-wrapper" aria-hidden="true" id="ticker-wrapper-2"></div>
        </div>
      </div>
    </section>

    <section id="status-update-banner-container"
             class="container mx-auto px-4 pt-3 transform transition-opacity duration-500 ease-in-out opacity-0 hidden">
        <div id="status-update-banner-content"
             class="bg-positive text-white px-4 py-2.5 rounded-md shadow-lg flex items-center w-full">
            <span class="text-lg mr-2.5">⚡️</span>
            <span id="status-update-banner-message" class="text-sm"></span>
        </div>
    </section>

    <div class="container mx-auto px-4 py-4">
      <div class="h-[90px] flex items-center justify-center rounded-lg bg-gray-800/50 text-sm text-gray-500">광고 배너 영역 (728×90)</div>
    </div>

    <section class="container mx-auto flex flex-col gap-4 px-4 py-4 md:flex-row md:items-center md:justify-between">
      <div class="relative w-full md:w-64">
        <select id="condition-filter-select" class="w-full appearance-none rounded-lg border border-gray-700 bg-card-bg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-accent-blue">
          <option value="all">조건 전체</option>
        </select>
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
          <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </div>
      </div>
      <div class="flex w-full gap-2 overflow-x-auto pb-2 md:w-auto md:pb-0" id="filter-buttons-group">
        <button data-filter="all"       class="filter-btn active rounded-lg px-4 py-2 text-sm font-medium transition flex-shrink-0">전체 추천</button>
        <button data-filter="favorites" class="filter-btn rounded-lg px-4 py-2 text-sm font-medium transition flex-shrink-0">관심종목</button>
        <button data-filter="today"     class="filter-btn rounded-lg px-4 py-2 text-sm font-medium transition flex-shrink-0">오늘만</button>
        <button data-filter="new"       class="filter-btn rounded-lg px-4 py-2 text-sm font-medium transition flex-shrink-0">NEW만</button>
        <button id="refresh-data-btn"    class="ml-auto flex items-center rounded-lg bg-gray-700 px-4 py-2 text-sm font-medium text-white transition hover:bg-gray-600 md:ml-0 flex-shrink-0">
          <svg class="mr-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
          새로고침
        </button>
      </div>
    </section>

    <section class="container mx-auto px-4 py-4">
      <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold">오늘 주목할만한 종목</h2>
          <div class="hidden md:flex flex-col text-xs text-gray-400 items-end">
              <span>마지막 업데이트: <span id="last-update-time">--:--:--</span></span>
              <span>다음 업데이트: <span id="update-countdown">--:--</span></span>
          </div>
      </div>
      <div id="stock-category-tabs" class="flex border-b border-gray-700 mb-6 overflow-x-auto pb-px">
          <button class="category-tab-btn tab-active px-4 sm:px-6 py-3 font-medium text-sm focus:outline-none whitespace-nowrap" data-category="realtime_news_stocks">실시간 호재 종목</button>
          <button class="category-tab-btn text-gray-400 hover:text-gray-200 px-4 sm:px-6 py-3 font-medium text-sm focus:outline-none whitespace-nowrap" data-category="low_pbr_stocks">저 PBR 종목</button>
          <button class="category-tab-btn text-gray-400 hover:text-gray-200 px-4 sm:px-6 py-3 font-medium text-sm focus:outline-none whitespace-nowrap" data-category="treasury_over_50">자사주 50% 이상 종목</button>
          <button class="category-tab-btn text-gray-400 hover:text-gray-200 px-4 sm:px-6 py-3 font-medium text-sm focus:outline-none whitespace-nowrap" data-category="treasury_accumulating">자사주 축적형 기업</button>
      </div>
      <div id="stock-cards-container" class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3"></div>
    </section>

    <div class="container mx-auto px-4 py-4">
      <div class="h-[100px] flex items-center justify-center rounded-lg bg-gray-800/50 text-sm text-gray-500">인피드 광고 영역 (320×100)</div>
    </div>

    <section class="container mx-auto px-4 py-6">
      <h2 class="mb-4 text-xl font-bold">최근 발견된 조건별 종목</h2>
      <div class="overflow-hidden rounded-lg bg-card-bg shadow-soft">
        <div class="flex overflow-x-auto border-b border-gray-700" id="condition-tabs-nav">
          <button class="tab-btn tab-active whitespace-nowrap px-6 py-3 font-medium" data-tab-id="tab-condition-a">무상증자</button>
          <button class="tab-btn whitespace-nowrap px-6 py-3 font-medium text-gray-400" data-tab-id="tab-condition-b">단일판매계약</button>
          <button class="tab-btn whitespace-nowrap px-6 py-3 font-medium text-gray-400" data-tab-id="tab-condition-c">제3자유상증자</button>
          <button class="tab-btn whitespace-nowrap px-6 py-3 font-medium text-gray-400" data-tab-id="tab-condition-d">자사주취득</button>
          <button class="tab-btn whitespace-nowrap px-6 py-3 font-medium text-gray-400" data-tab-id="tab-condition-e">외국증권사매수</button>
        </div>
        <div id="tab-condition-a" class="tab-content p-4"></div>
        <div id="tab-condition-b" class="tab-content hidden p-4"></div>
        <div id="tab-condition-c" class="tab-content hidden p-4"></div>
        <div id="tab-condition-d" class="tab-content hidden p-4"></div>
        <div id="tab-condition-e" class="tab-content hidden p-4"></div>
      </div>
    </section>

    <div class="container mx-auto hidden px-4 py-4 lg:block">
      <div class="mx-auto flex h-[600px] w-[300px] items-center justify-center rounded-lg bg-gray-800/50 text-sm text-gray-500">사이드 광고 영역 (300×600)</div>
    </div>

    <section class="container mx-auto px-4 py-6">
      <h2 class="mb-4 text-xl font-bold">종합 토론방</h2>
      <div class="rounded-lg bg-card-bg p-6 shadow-soft">
        <div id="forum-posts-container"></div>
        <div class="mt-8 pt-6 border-t border-gray-700">
          <div class="mb-2 flex items-center">
            <div class="flex h-8 w-8 items-center justify-center rounded-full bg-accent-blue/20 text-sm font-bold text-accent-blue">나</div>
            <span class="ml-2 text-sm font-medium">새 게시물 작성하기</span>
          </div>
          <div class="flex items-start gap-2"><input id="new-post-title-input" type="text" placeholder="제목을 입력하세요" class="w-full mb-2 rounded-lg border border-gray-700 bg-gray-800 px-4 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-accent-blue" /></div>
          <div class="flex"><textarea id="new-post-body-input" placeholder="토론방에 새 글을 남겨보세요" rows="3" class="flex-1 rounded-l-lg border border-gray-700 bg-gray-800 px-4 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-accent-blue"></textarea><button id="new-post-submit-btn" class="rounded-r-lg bg-accent-blue px-4 py-2 text-sm font-medium text-white transition hover:bg-blue-600 self-stretch">등록</button></div>
        </div>
      </div>
    </section>
  </div> <div id="coin-service-content" class="container mx-auto px-4 py-20 text-center hidden">
      <svg class="mx-auto h-16 w-16 text-accent-blue" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" />
      </svg>
      <h1 class="mt-6 text-2xl font-bold text-gray-200">코인 서비스</h1>
      <p class="mt-2 text-gray-400">코인 관련 정보는 현재 준비 중입니다. 곧 만나보실 수 있습니다!</p>
  </div>

  <div id="toast-notification"
       class="fixed bottom-6 right-6 bg-positive text-white px-5 py-3 rounded-lg shadow-xl text-sm
              transform transition-all duration-300 ease-in-out opacity-0 translate-y-10 hidden
              flex items-center space-x-3">
    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
    <span id="toast-message-content"></span>
  </div>

  <div id="signup-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-[100] p-4">
    <div class="bg-card-bg p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-md">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl sm:text-2xl font-bold text-white">회원가입</h2>
            <button id="close-signup-modal-btn" class="text-gray-400 hover:text-white text-2xl">&times;</button>
        </div>
        <form id="signup-form" class="space-y-4" novalidate>
            <div>
                <label for="signup-id" class="block text-sm font-medium text-gray-300 mb-1">아이디</label>
                <div class="flex">
                    <input type="text" id="signup-id" name="signup-id" required autocomplete="username"
                           class="modal-input flex-grow rounded-l-md sm:text-sm" placeholder="영문, 숫자 포함 6~12자">
                    <button type="button" id="check-id-duplicate-btn" 
                            class="bg-gray-600 hover:bg-gray-500 text-white px-3 py-2 text-xs sm:text-sm font-medium rounded-r-md whitespace-nowrap">중복확인</button>
                </div>
                <p id="signup-id-feedback" class="text-xs mt-1 h-4"></p> 
            </div>
            <div>
                <label for="signup-password" class="block text-sm font-medium text-gray-300 mb-1">비밀번호</label>
                <input type="password" id="signup-password" name="signup-password" required autocomplete="new-password"
                       class="modal-input w-full sm:text-sm" placeholder="8자 이상, 문자/숫자/특수문자 포함">
            </div>
            <div>
                <label for="signup-password-confirm" class="block text-sm font-medium text-gray-300 mb-1">비밀번호 확인</label>
                <input type="password" id="signup-password-confirm" name="signup-password-confirm" required autocomplete="new-password"
                       class="modal-input w-full sm:text-sm" placeholder="비밀번호를 다시 입력하세요">
                <p id="signup-password-feedback" class="text-xs mt-1 h-4"></p>
            </div>
            <div class="pt-2">
                <button type="submit" 
                        class="w-full bg-accent-blue hover:bg-blue-700 text-white font-bold py-2.5 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-deep-navy focus:ring-accent-blue transition duration-150 ease-in-out">
                    가입하기
                </button>
            </div>
        </form>
    </div>
  </div>

  <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-[100] p-4">
      <div class="bg-card-bg p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-md">
          <div class="flex justify-between items-center mb-6">
              <h2 class="text-xl sm:text-2xl font-bold text-white">로그인</h2>
              <button id="close-login-modal-btn" class="text-gray-400 hover:text-white text-2xl">&times;</button>
          </div>
          <form id="login-form" class="space-y-4" novalidate>
              <div>
                  <label for="login-id" class="block text-sm font-medium text-gray-300 mb-1">아이디</label>
                  <input type="text" id="login-id" name="login-id" required autocomplete="username"
                         class="modal-input w-full sm:text-sm" placeholder="아이디를 입력하세요">
              </div>
              <div class="mb-2">
                  <label for="login-password" class="block text-sm font-medium text-gray-300 mb-1">비밀번호</label>
                  <input type="password" id="login-password" name="login-password" required autocomplete="current-password"
                         class="modal-input w-full sm:text-sm" placeholder="비밀번호를 입력하세요">
              </div>
              <p id="login-feedback" class="text-xs text-center h-4 mb-2"></p>
              <div class="pt-2">
                  <button type="submit"
                          class="w-full bg-accent-blue hover:bg-blue-700 text-white font-bold py-2.5 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-deep-navy focus:ring-accent-blue transition duration-150 ease-in-out">
                      로그인
                  </button>
              </div>
          </form>
      </div>
  </div>


  <script>
    const AppConfig = { /* 이전과 동일 */ };
    const MockData = { /* 이전과 동일 */ };
    // AppConfig, MockData 내용은 이전 답변의 것을 그대로 사용합니다. (길이 관계상 생략)
          AppConfig.tickerUpdateIntervalSeconds = 60;
      AppConfig.conditionColorMap = { "무상증자": "condition-a", "단일판매계약": "condition-b", "제3자유상증자": "condition-c", "자사주취득": "condition-d", "외국증권사매수": "condition-e" };
      AppConfig.conditionTabIdMap = { "무상증자": "tab-condition-a", "단일판매계약": "tab-condition-b", "제3자유상증자": "tab-condition-c", "자사주취득": "tab-condition-d", "외국증권사매수": "tab-condition-e" };
      AppConfig.elements = {
        tickerWrapper1: document.getElementById('ticker-wrapper-1'),
        tickerWrapper2: document.getElementById('ticker-wrapper-2'),
        lastUpdateTime: document.getElementById('last-update-time'),
        updateCountdown: document.getElementById('update-countdown'),
        stockCardsContainer: document.getElementById('stock-cards-container'),
        conditionFilterSelect: document.getElementById('condition-filter-select'),
        filterButtonsGroup: document.getElementById('filter-buttons-group'),
        refreshDataBtn: document.getElementById('refresh-data-btn'),
        conditionTabsNav: document.getElementById('condition-tabs-nav'),
        forumPostsContainer: document.getElementById('forum-posts-container'),
        newPostTitleInput: document.getElementById('new-post-title-input'),
        newPostBodyInput: document.getElementById('new-post-body-input'),
        newPostSubmitBtn: document.getElementById('new-post-submit-btn'),
        notificationToggle: document.getElementById('notification-toggle'),
        toastNotification: document.getElementById('toast-notification'),
        toastMessageContent: document.getElementById('toast-message-content'),
        statusUpdateBannerContainer: document.getElementById('status-update-banner-container'),
        statusUpdateBannerMessage: document.getElementById('status-update-banner-message'),
        stockCategoryTabs: document.getElementById('stock-category-tabs'),
        mainNavigation: document.getElementById('main-navigation'),
        navStocksLink: document.getElementById('nav-stocks'),
        navCoinsLink: document.getElementById('nav-coins'),
        stockServiceContent: document.getElementById('stock-service-content'),
        coinServiceContent: document.getElementById('coin-service-content'),
        authContainer: document.getElementById('auth-container'),
        signupBtnHeader: document.getElementById('signup-btn-header'),
        loginBtnHeader: document.getElementById('login-btn-header'),
        welcomeMessage: document.getElementById('welcome-message'),
        logoutBtnHeader: document.getElementById('logout-btn-header'),
        signupModal: document.getElementById('signup-modal'),
        signupForm: document.getElementById('signup-form'),
        signupIdInput: document.getElementById('signup-id'),
        checkIdDuplicateBtn: document.getElementById('check-id-duplicate-btn'),
        signupIdFeedback: document.getElementById('signup-id-feedback'),
        signupPasswordInput: document.getElementById('signup-password'),
        signupPasswordConfirmInput: document.getElementById('signup-password-confirm'),
        signupPasswordFeedback: document.getElementById('signup-password-feedback'),
        closeSignupModalBtn: document.getElementById('close-signup-modal-btn'),
        loginModal: document.getElementById('login-modal'),
        loginForm: document.getElementById('login-form'),
        loginIdInput: document.getElementById('login-id'),
        loginPasswordInput: document.getElementById('login-password'),
        loginFeedback: document.getElementById('login-feedback'),
        closeLoginModalBtn: document.getElementById('close-login-modal-btn'),
      };
    MockData.marketTickerItems = [
        {label:"KOSPI", value:"2,785.38", change:"+0.42%", dir:"positive"}, {label:"KOSDAQ", value:"892.37", change:"-0.18%", dir:"negative"},
        {label:"USD/KRW", value:"1,328.50", change:"+0.05%", dir:"neutral"}, {label:"WTI", value:"78.24", change:"+1.32%", dir:"positive"},
        {label:"Gold", value:"2,342.10", change:"+0.75%", dir:"positive"}, {label:"Bitcoin", value:"67,890.45", change:"+2.14%", dir:"positive"},
        {label:"NASDAQ", value:"16,742.39", change:"+0.83%", dir:"positive"}, {label:"S&P500", value:"5,234.18", change:"+0.51%", dir:"positive"}
      ];
    MockData.sampleStocks = [
        { code:"005930", name:"삼성전자", industry:"electronics", price:"78,500원", changeDir:"positive", change:"+2.34%", today:true, isNew:false, initiallyNew: false, condition:"무상증자", type:"강력매수", confidence:87, metrics:[ {label:"증자비율", value:"10:5"}, {label:"기준일",  value:"2025-03-15"}, {label:"권리락일",value:"2025-03-16"} ], reason:["메모리 반도체 가격 상승세 지속","AI 서버용 HBM 수요 급증","2분기 실적 전망치 상향 조정"] },
        { code:"035720", name:"카카오", industry:"it", price:"52,300원", changeDir:"negative", change:"-1.05%", today:true, isNew:true, initiallyNew: true, condition:"단일판매계약", type:"매수", confidence:72, metrics:[ {label:"매출 대비", value:"12%"}, {label:"계약금액", value:"120억"}, {label:"상대방", value:"(주)넥슨"} ], reason:["AI 기반 서비스 확장 전략 발표","핀테크 부문 거래액 증가세","단기 조정 후 기술적 반등 신호"] },
        { code:"051910", name:"LG화학", industry:"chemical", price:"625,000원", changeDir:"positive", change:"+3.78%", today:true, isNew:false, initiallyNew: false, condition:"제3자유상증자", type:"강력매수", confidence:91, metrics:[ {label:"발행가액", value:"58만"}, {label:"증자 규모", value:"1.2조원"}, {label:"납입일", value:"2025-06-30"} ], reason:["배터리 소재 신규 계약 체결","북미 시장 점유율 확대","친환경 소재 부문 성장성 주목"] },
        { code:"035420", name:"NAVER", industry:"it", price:"214,500원", changeDir:"positive", change:"+1.25%", today:true, isNew:false, initiallyNew: false, condition:"외국증권사매수", type:"매수", confidence:83, metrics:[ {label:"매수주체", value:"모건스탠리"},{label:"순매수량", value:"10만주"} ], reason:["생성형 AI 서비스 출시 임박","웹툰/웹소설 글로벌 매출 증가","클라우드 사업 성장세 가속화"] },
        { code:"005380", name:"현대차", industry:"auto", price:"243,000원", changeDir:"negative", change:"-0.45%", today:false, isNew:false, initiallyNew: false, condition:"자사주취득", type:"관망", confidence:65, metrics:[ {label:"시총 대비", value:"2.1%"}, {label:"취득기간", value:"~25/12/31"} ], reason:["전기차 판매 호조세 지속","원자재 가격 상승 부담","기술적 지지선 근접, 반등 가능성"] },
        { code:"068270", name:"셀트리온", industry:"pharma", price:"187,500원", changeDir:"positive", change:"+4.12%", today:true, isNew:true, initiallyNew: true, condition:"무상증자", type:"강력매수", confidence:89, metrics:[ {label:"증자비율", value:"2:1"}, {label:"기준일",  value:"2025-04-10"} ], reason:["신약 FDA 승인 임박","유럽 시장 바이오시밀러 점유율 확대","기관 매수세 유입 증가"] }
      ];
    MockData.forumPosts = [
        { id: "post1", user:"김투자", ago:"2시간 전", title:"오늘 시장 분석", body:"반도체 업종이 강세를 보이고 있네요. 특히 삼성전자와 SK하이닉스의 상승세가 두드러집니다. AI 관련 수혜주로 계속 주목해야 할 것 같습니다.", likes:23, replies: [ { id: "reply1-1", user: "박매수", text: "동의합니다. HBM 관련주 눈여겨보고 있습니다.", ago: "1시간 전" }, { id: "reply1-2", user: "최고점", text: "삼전 가즈아!", ago: "30분 전" } ] },
        { id: "post2", user:"이코노", ago:"3시간 전", title:"다음주 전망은?", body:"미국 금리 인하 가능성이 솔솔 나오고 있는데, 국내 증시에도 훈풍이 불까요? 다들 어떻게 생각하시는지 궁금합니다.", likes:15, replies: [] }
      ];

    const UIRenderer = {
      buildTickerHTML: function() { return MockData.marketTickerItems.map(item => `<div class="ticker-item"><span class="font-medium">${item.label}</span><span class="ml-1 text-${item.dir}">${item.value} ${item.change}</span></div>`).join(""); },
      renderTickers: function() { const html = this.buildTickerHTML(); AppConfig.elements.tickerWrapper1.innerHTML = html; AppConfig.elements.tickerWrapper2.innerHTML = html; },
      populateConditionFilterOptions: function() {
        if (!AppConfig.elements.conditionFilterSelect) return;
        const conditions = Object.keys(AppConfig.conditionColorMap);
        let optionsHTML = '<option value="all">조건 전체</option>';
        conditions.forEach(condition => { optionsHTML += `<option value="${condition}">${condition}</option>`; });
        AppConfig.elements.conditionFilterSelect.innerHTML = optionsHTML;
      },
      renderStockCards: function(stocksToRender = MockData.sampleStocks) {
        const container = AppConfig.elements.stockCardsContainer;
        if (!container) { console.error("Stock cards container not found"); return; }

        if (!stocksToRender || stocksToRender.length === 0) {
            container.innerHTML = `
                <div class="col-span-full text-center text-gray-500 py-10">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                    </svg>
                    <h3 class="mt-2 text-sm font-medium text-gray-300">데이터 없음</h3>
                    <p class="mt-1 text-sm text-gray-500">선택하신 카테고리에 해당하는 종목이 없습니다.</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = stocksToRender.map(stock => {
          const badgeColorClass = AppConfig.conditionColorMap[stock.condition] || 'accent-blue';
          const isFavorite = AppLogic.favoritedStockCodes.has(stock.code);
          return `
            <div class="stock-card relative rounded-lg bg-card-bg p-5 shadow-soft" 
                 data-industry="${stock.industry}" data-condition="${stock.condition}" 
                 data-new="${stock.isNew}" data-today="${stock.today}" data-code="${stock.code}">
              <div class="mb-3 flex items-start justify-between">
                <div class="flex items-center"><span class="condition-badge bg-${badgeColorClass} bg-opacity-20 text-${badgeColorClass}">${stock.condition}</span><h3 class="text-lg font-bold">${stock.name}</h3></div>
                <div class="flex items-center">
                  <button class="favorite-star ${isFavorite ? 'text-yellow-500 active' : 'text-gray-400'} hover:text-yellow-500 mr-2" aria-label="Toggle Favorite">
                    <svg class="h-6 w-6 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>
                  </button>
                  <div class="rounded-md bg-${stock.changeDir} bg-opacity-20 px-2 py-1 text-sm font-medium text-${stock.changeDir}">${stock.change}</div>
                </div>
              </div>
              <div class="mb-2 text-sm text-gray-400">${stock.code} &middot; ${stock.industry.toUpperCase()}</div>
              <div class="mb-5"><div class="mb-1 text-sm font-medium">주요지표</div><div class="space-y-1">${stock.metrics.slice(0, 3).map(m => `<div class="metric-box"><span class="metric-label">${m.label}</span><span class="metric-value">${m.value}</span></div>`).join("")}</div></div>
              <div class="mb-4 flex justify-between text-sm"><span class="text-gray-400">추천 타임</span><span class="font-medium ${stock.type.startsWith('강') ? 'text-positive' : 'text-gray-300'}">${stock.type}</span></div>
              <div class="mb-1">
                  <div class="mb-1 flex justify-between text-sm"><span class="text-gray-400">신뢰도</span><span class="font-medium">${stock.confidence}%</span></div>
                  <div class="confidence-bar-bg"><div class="confidence-bar-fill" style="width:${stock.confidence}%"></div></div>
              </div>
              <div class="mt-4"><div class="mb-2 text-sm font-medium">추천 이유</div><ul class="list-disc pl-5 text-sm text-gray-300">${stock.reason.map(r=>`<li>${r}</li>`).join("")}</ul></div>
              <div class="mt-4 flex justify-end text-xs text-gray-400">추천 시각: 09:15</div>
              ${stock.isNew ? '<div class="stock-update absolute top-2 right-2 text-xs font-bold text-bright-green">NEW</div>' : ''}
            </div>
          `;
        }).join("");
      },
      renderConditionTabs: function() {
        Object.values(AppConfig.conditionTabIdMap).forEach(tabId => {
          const tabElement = document.getElementById(tabId);
          if (tabElement) tabElement.innerHTML = "";
        });

        MockData.sampleStocks.forEach(stock => {
          const tabId = AppConfig.conditionTabIdMap[stock.condition];
          const tabElement = document.getElementById(tabId);
          if (tabElement) {
            const metricsHTML = stock.metrics && stock.metrics.length > 0 ?
                stock.metrics.map(metric => `
                    <span class="inline-block bg-gray-700/60 px-2 py-0.5 rounded-full text-xs whitespace-nowrap">
                        <span class="text-gray-400">${metric.label}:</span>
                        <span class="text-white ml-1">${metric.value}</span>
                    </span>
                `).join('')
                : '';
            
            const confidenceBarHTML = stock.confidence !== undefined ? `
                <div class="inline-flex items-center whitespace-nowrap">
                    <span class="text-xs text-gray-400 mr-1.5">신뢰도:</span>
                    <div class="confidence-bar-bg rounded" style="width: 100px; height: 6px;">
                        <div class="confidence-bar-fill h-full rounded" style="width:${stock.confidence}%"></div>
                    </div>
                    <span class="text-xs text-gray-300 ml-1.5">${stock.confidence}%</span>
                </div>
            ` : '';

            tabElement.insertAdjacentHTML('beforeend', `
              <div class="flex items-start justify-between py-3 border-b border-gray-700 last:border-none">
                <div class="flex-grow flex items-start min-w-0">
                    <div class="flex-shrink-0 mr-4">
                        <span class="block text-sm font-medium text-gray-100">${stock.name}</span>
                        <span class="block text-xs text-gray-400">${stock.code}</span>
                    </div>
                    <div class="flex-grow min-w-0"> 
                        <div class="flex flex-wrap items-center gap-x-3 gap-y-1">
                            ${metricsHTML ? `<div class="flex flex-wrap gap-x-1.5 gap-y-1">${metricsHTML}</div>` : ''}
                            ${confidenceBarHTML ? `<div class="inline-flex items-center mt-1 sm:mt-0">${confidenceBarHTML}</div>` : ''}
                        </div>
                    </div>
                </div>
                <div class="text-sm font-semibold text-gray-100 flex-shrink-0 ml-4">${stock.price}</div>
              </div>
            `);
          }
        });

        Object.values(AppConfig.conditionTabIdMap).forEach(tabId => {
          const tabElement = document.getElementById(tabId);
          if (tabElement && !tabElement.children.length) {
            tabElement.innerHTML = '<p class="text-sm text-gray-400">해당 조건의 종목이 없습니다.</p>';
          }
        });
      },
      renderForumPosts: function() {
        AppConfig.elements.forumPostsContainer.innerHTML = MockData.forumPosts.map(p => `
          <div class="post-card" data-post-id="${p.id}">
            <div class="post-header mb-2">
              <div class="flex items-center gap-3">
                <div class="flex h-8 w-8 items-center justify-center rounded-full bg-accent-blue/20 text-sm font-bold text-accent-blue">${p.user[0]}</div>
                <div><div class="font-medium">${p.user}</div><div class="text-xs text-gray-400">${p.ago}</div></div>
              </div>
              <div class="flex gap-3 text-xs text-gray-400">
                <button class="like-btn forum-badge ${AppLogic.likedPostIds.has(p.id) ? 'liked text-accent-blue' : 'text-gray-400'}" data-post-id="${p.id}" aria-label="Like this post">
                  <svg class="inline w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path></svg>
                  <span>${p.likes}</span>
                </button>
                <span class="forum-badge">
                  <svg class="inline w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v8a2 2 0 01-2 2H7l-4 4V10a2 2 0 012-2h2"></path></svg>
                  <span>${p.replies ? p.replies.length : 0}</span>
                </span>
              </div>
            </div>
            <div class="mb-1 text-sm font-semibold">${p.title}</div>
            <p class="text-sm text-gray-300 mb-3">${p.body}</p>
            <div class="replies-container mt-4 pl-5 border-l-2 border-gray-700/50 space-y-3">
              ${p.replies && p.replies.length > 0 ? p.replies.map(reply => `
                <div class="reply-card">
                  <div class="flex items-center gap-2 mb-1">
                    <div class="flex h-6 w-6 items-center justify-center rounded-full bg-gray-600 text-xs font-bold text-gray-200">${reply.user[0]}</div>
                    <div>
                      <span class="font-medium text-sm text-gray-200">${reply.user}</span>
                      <span class="text-xs text-gray-500 ml-2">${reply.ago}</span>
                    </div>
                  </div>
                  <p class="text-sm text-gray-400 ml-8">${reply.text}</p>
                </div>
              `).join('') : '<p class="text-xs text-gray-500 italic">아직 댓글이 없습니다.</p>'}
            </div>
            <div class="reply-form mt-3 md:pl-5">
              <div class="flex items-center gap-1 sm:gap-2">
                <input type="text" class="reply-input-field flex-1 min-w-0 rounded-l-lg border border-gray-600 bg-gray-700/80 px-3 py-1.5 text-sm text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-accent-blue focus:border-accent-blue" placeholder="댓글 남기기...">
                <button class="reply-submit-btn rounded-r-lg bg-accent-blue px-2 sm:px-3 py-1.5 text-xs font-medium text-white transition hover:bg-blue-600 flex-shrink-0" data-post-id="${p.id}">등록</button>
              </div>
            </div>
          </div>
        `).join("");
      },
      updateTimersUI: function(val) { const mm=String(Math.floor(val/60)).padStart(2,'0'); const ss=String(val%60).padStart(2,'0'); AppConfig.elements.updateCountdown.textContent=`${mm}:${ss}`;},
      setLastUpdateTime: function() { AppConfig.elements.lastUpdateTime.textContent = new Date().toTimeString().slice(0,8); }
    };

    const AppLogic = {
      nextUpdateSeconds: AppConfig.tickerUpdateIntervalSeconds,
      countdownIntervalId: null,
      notificationsEnabled: true,
      newStockNotificationShownFor: new Set(),
      toastTimeoutId: null,
      statusUpdateBannerTimeoutId: null,
      favoritedStockCodes: new Set(),
      currentStockCategory: 'realtime_news_stocks', 
      currentUser: null, 
      USERS_STORAGE_KEY: 'snappiko_users', 
      CURRENT_USER_STORAGE_KEY: 'snappiko_currentUser',
      likedPostIds: new Set(), // NEW: 좋아요 누른 게시물 ID 저장

      getUsers: function() { return JSON.parse(localStorage.getItem(this.USERS_STORAGE_KEY)) || {}; },
      saveUsers: function(users) { localStorage.setItem(this.USERS_STORAGE_KEY, JSON.stringify(users)); },

      updateAuthUI: function() {
        const { signupBtnHeader, loginBtnHeader, welcomeMessage, logoutBtnHeader } = AppConfig.elements;
        if (!signupBtnHeader || !loginBtnHeader || !welcomeMessage || !logoutBtnHeader) { return; }
        if (this.currentUser) {
            welcomeMessage.textContent = `${this.currentUser}님, 환영합니다!`;
            welcomeMessage.classList.remove('hidden');
            logoutBtnHeader.classList.remove('hidden');
            signupBtnHeader.classList.add('hidden');
            loginBtnHeader.classList.add('hidden');
        } else {
            welcomeMessage.classList.add('hidden');
            logoutBtnHeader.classList.add('hidden');
            signupBtnHeader.classList.remove('hidden');
            loginBtnHeader.classList.remove('hidden');
        }
      },
      toggleModal: function(modalElement, show) {
          if (modalElement) {
              modalElement.classList.toggle('hidden', !show);
              modalElement.classList.toggle('flex', show); 
          }
      },
      handleCheckIdDuplicate: function() {
        const id = AppConfig.elements.signupIdInput.value.trim();
        const feedbackEl = AppConfig.elements.signupIdFeedback;
        if (!id) {
            feedbackEl.textContent = "아이디를 입력해주세요.";
            feedbackEl.className = 'text-xs mt-1 h-4 feedback-error';
            return false;
        }
        if (!/^[a-z0-9]{6,12}$/.test(id)) {
            feedbackEl.textContent = "아이디는 영문 소문자, 숫자 조합 6~12자여야 합니다.";
            feedbackEl.className = 'text-xs mt-1 h-4 feedback-error';
            return false;
        }
        const users = this.getUsers();
        if (users[id]) {
            feedbackEl.textContent = "이미 사용 중인 아이디입니다.";
            feedbackEl.className = 'text-xs mt-1 h-4 feedback-error';
            return false;
        } else {
            feedbackEl.textContent = "사용 가능한 아이디입니다.";
            feedbackEl.className = 'text-xs mt-1 h-4 feedback-success';
            return true;
        }
      },
      handleSignup: function(event) {
        event.preventDefault();
        const id = AppConfig.elements.signupIdInput.value.trim();
        const password = AppConfig.elements.signupPasswordInput.value;
        const passwordConfirm = AppConfig.elements.signupPasswordConfirmInput.value;
        const idFeedbackEl = AppConfig.elements.signupIdFeedback;
        const passwordFeedbackEl = AppConfig.elements.signupPasswordFeedback;

        passwordFeedbackEl.textContent = ''; 

        if (idFeedbackEl.textContent !== "사용 가능한 아이디입니다.") {
            AppConfig.elements.signupIdInput.focus();
            idFeedbackEl.textContent = "아이디 중복확인을 먼저 해주세요.";
            idFeedbackEl.className = 'text-xs mt-1 h-4 feedback-error';
            return;
        }
        if (password.length < 8) { 
            passwordFeedbackEl.textContent = "비밀번호는 8자 이상이어야 합니다.";
            passwordFeedbackEl.className = 'text-xs mt-1 h-4 feedback-error';
            return;
        }
        if (password !== passwordConfirm) {
            passwordFeedbackEl.textContent = "비밀번호가 일치하지 않습니다.";
            passwordFeedbackEl.className = 'text-xs mt-1 h-4 feedback-error';
            return;
        }

        const users = this.getUsers();
        users[id] = password; 
        this.saveUsers(users);
        
        alert("회원가입이 완료되었습니다! 로그인해주세요.");
        this.toggleModal(AppConfig.elements.signupModal, false);
        if (AppConfig.elements.signupForm) AppConfig.elements.signupForm.reset();
        if (idFeedbackEl) idFeedbackEl.textContent = ''; 
        if (passwordFeedbackEl) passwordFeedbackEl.textContent = '';
      },
      handleLogin: function(event) {
        event.preventDefault();
        const id = AppConfig.elements.loginIdInput.value.trim();
        const password = AppConfig.elements.loginPasswordInput.value;
        const feedbackEl = AppConfig.elements.loginFeedback;
        const users = this.getUsers();

        if (users[id] && users[id] === password) { 
            this.currentUser = id;
            localStorage.setItem(this.CURRENT_USER_STORAGE_KEY, id);
            this.updateAuthUI();
            this.toggleModal(AppConfig.elements.loginModal, false);
            if(AppConfig.elements.loginForm) AppConfig.elements.loginForm.reset();
            if(feedbackEl) feedbackEl.textContent = '';
        } else {
            if(feedbackEl) {
                feedbackEl.textContent = "아이디 또는 비밀번호가 올바르지 않습니다.";
                feedbackEl.className = 'text-xs text-center h-4 mb-2 feedback-error';
            }
        }
      },
      handleLogout: function() {
        this.currentUser = null;
        localStorage.removeItem(this.CURRENT_USER_STORAGE_KEY);
        this.updateAuthUI();
      },
      checkLoggedInStatus: function() {
        const loggedInUser = localStorage.getItem(this.CURRENT_USER_STORAGE_KEY);
        if (loggedInUser) {
            this.currentUser = loggedInUser;
        }
        this.updateAuthUI();
      },

      applyStockFilters: function() {
        const selectedCondDropdownValue = AppConfig.elements.conditionFilterSelect.value;
        const activeTopFilterButton = AppConfig.elements.filterButtonsGroup.querySelector('.filter-btn.active');
        const currentTopFilterType = activeTopFilterButton ? activeTopFilterButton.dataset.filter : 'all';

        let baseStocksForCategory = [];
        switch (this.currentStockCategory) {
            case 'realtime_news_stocks':
                baseStocksForCategory = [...MockData.sampleStocks];
                break;
            case 'low_pbr_stocks':
            case 'treasury_accumulating':
            case 'treasury_over_50': 
                baseStocksForCategory = []; 
                break;
            default: 
                baseStocksForCategory = [...MockData.sampleStocks];
        }

        let 최종필터된종목들 = baseStocksForCategory;

        if (currentTopFilterType === 'favorites') {
            최종필터된종목들 = 최종필터된종목들.filter(stock => AppLogic.favoritedStockCodes.has(stock.code));
        } else if (currentTopFilterType === 'today') {
            최종필터된종목들 = 최종필터된종목들.filter(stock => stock.today === true);
        } else if (currentTopFilterType === 'new') {
            최종필터된종목들 = 최종필터된종목들.filter(stock => stock.isNew === true);
        }
        
        if (selectedCondDropdownValue !== 'all') {
            최종필터된종목들 = 최종필터된종목들.filter(stock => stock.condition === selectedCondDropdownValue);
        }

        UIRenderer.renderStockCards(최종필터된종목들);
      },
      handleFilterButtonClick: function(e) { 
        const btn = e.target.closest('.filter-btn'); 
        if(!btn || btn.classList.contains('active')) return;
        AppConfig.elements.filterButtonsGroup.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active')); 
        btn.classList.add('active'); 
        AppLogic.applyStockFilters(); 
      },
      handleConditionFilterChange: function() { AppLogic.applyStockFilters(); },
      handleFavoriteToggle: function(e) {
        const starButton = e.target.closest('.favorite-star');
        if (!starButton) return;

        const stockCard = starButton.closest('.stock-card');
        const stockCode = stockCard ? stockCard.dataset.code : null;
        if (!stockCode) return;

        const isCurrentlyFavorite = AppLogic.favoritedStockCodes.has(stockCode);

        if (isCurrentlyFavorite) {
            AppLogic.favoritedStockCodes.delete(stockCode);
            starButton.classList.remove('active', 'text-yellow-500');
            starButton.classList.add('text-gray-400');
        } else {
            AppLogic.favoritedStockCodes.add(stockCode);
            starButton.classList.add('active', 'text-yellow-500');
            starButton.classList.remove('text-gray-400');
        }
        
        const activeFilterButton = AppConfig.elements.filterButtonsGroup.querySelector('.filter-btn.active');
        if (activeFilterButton && activeFilterButton.dataset.filter === 'favorites') {
            AppLogic.applyStockFilters();
        }
      },
      handleTabNavigation: function(e) {
        const btn = e.target.closest('.tab-btn'); if(!btn) return;
        AppConfig.elements.conditionTabsNav.querySelectorAll('.tab-btn').forEach(b=>{b.classList.remove('tab-active','text-white');b.classList.add('text-gray-400');});
        btn.classList.add('tab-active','text-white'); btn.classList.remove('text-gray-400');
        document.querySelectorAll('.tab-content').forEach(c=>c.classList.add('hidden'));
        const targetId=btn.dataset.tabId; if(targetId){const targetEl=document.getElementById(targetId); if(targetEl)targetEl.classList.remove('hidden');}
      },
      handleAddNewPost: function() {
        const titleInput = AppConfig.elements.newPostTitleInput;
        const bodyInput = AppConfig.elements.newPostBodyInput;
        const titleText = titleInput.value.trim();
        const bodyText = bodyInput.value.trim();
        if (titleText && bodyText) { MockData.forumPosts.unshift({id: `post${Date.now()}`,user: "나",ago: "방금 전",title: titleText,body: bodyText,likes: 0,replies: []}); UIRenderer.renderForumPosts(); titleInput.value = ''; bodyInput.value = ''; } else { alert("제목과 내용을 모두 입력해주세요."); }
      },
      // MODIFIED: 게시판 좋아요 토글 기능
      handleLikePost: function(event) {
        const likeButton = event.target.closest('.like-btn');
        if (!likeButton) return;
        const postId = likeButton.dataset.postId;
        const post = MockData.forumPosts.find(p => p.id === postId);

        if (post) {
            if (AppLogic.likedPostIds.has(postId)) {
                AppLogic.likedPostIds.delete(postId);
                post.likes--; 
            } else {
                AppLogic.likedPostIds.add(postId);
                post.likes++; 
            }
            UIRenderer.renderForumPosts(); 
        }
      },
      handleAddReply: function(event) {
        const replyButton = event.target.closest('.reply-submit-btn');
        if (!replyButton) return;
        const postId = replyButton.dataset.postId;
        const post = MockData.forumPosts.find(p => p.id === postId);
        const postCardElement = replyButton.closest('.post-card');
        const replyInputField = postCardElement ? postCardElement.querySelector('.reply-input-field') : null;
        if (post && replyInputField) { const replyText = replyInputField.value.trim(); if (replyText) { if (!post.replies) { post.replies = []; } post.replies.push({id: `reply${postId}-${Date.now()}`,user: "나",text: replyText,ago: "방금 전"}); UIRenderer.renderForumPosts();}}
      },
      showToastNotification: function(stockName) {
        if (!this.notificationsEnabled || !AppConfig.elements.toastNotification || !AppConfig.elements.toastMessageContent) return;
        if (this.toastTimeoutId) clearTimeout(this.toastTimeoutId);
        AppConfig.elements.toastMessageContent.innerHTML = `<strong class="font-semibold">${stockName}</strong> - 새로운 추천 종목!`;
        AppConfig.elements.toastNotification.classList.remove('hidden', 'opacity-0', 'translate-y-10');
        AppConfig.elements.toastNotification.classList.add('opacity-100', 'translate-y-0');
        this.toastTimeoutId = setTimeout(() => {
            AppConfig.elements.toastNotification.classList.remove('opacity-100', 'translate-y-0');
            AppConfig.elements.toastNotification.classList.add('opacity-0', 'translate-y-10');
            setTimeout(() => { AppConfig.elements.toastNotification.classList.add('hidden'); }, 300);
        }, 4000);
      },
      processNewStockNotifications: function(stocks) {
        if (!this.notificationsEnabled) return;
        stocks.forEach(stock => {
            if (stock.isNew && !this.newStockNotificationShownFor.has(stock.code)) {
                this.showToastNotification(stock.name);
                this.newStockNotificationShownFor.add(stock.code);
            }
        });
      },
      showStatusUpdateBanner: function() {
        const bannerContainer = AppConfig.elements.statusUpdateBannerContainer;
        const bannerMessage = AppConfig.elements.statusUpdateBannerMessage;
        if (!bannerContainer || !bannerMessage) return;
        if (this.statusUpdateBannerTimeoutId) clearTimeout(this.statusUpdateBannerTimeoutId);

        const now = new Date();
        const timeString = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
        bannerMessage.textContent = ` ${timeString} 추천 정보가 업데이트 되었습니다!`;

        bannerContainer.classList.remove('hidden', 'opacity-0');
        void bannerContainer.offsetWidth;
        bannerContainer.classList.add('opacity-100');

        this.statusUpdateBannerTimeoutId = setTimeout(() => {
            bannerContainer.classList.remove('opacity-100');
            bannerContainer.classList.add('opacity-0');
            setTimeout(() => {
                bannerContainer.classList.add('hidden');
            }, 500);
        }, 3000);
      },
      startUpdateTimer: function() {
        if (this.countdownIntervalId) clearInterval(this.countdownIntervalId);
        this.countdownIntervalId = setInterval(() => {
            UIRenderer.updateTimersUI(this.nextUpdateSeconds);
            if (this.nextUpdateSeconds === 0) {
                this.nextUpdateSeconds = AppConfig.tickerUpdateIntervalSeconds;
                UIRenderer.setLastUpdateTime();
                console.log("Automatic data refresh cycle triggered...");
                AppLogic.applyStockFilters(); 
                UIRenderer.renderConditionTabs(); 
                const newStocksForToast = MockData.sampleStocks.filter(stock => stock.isNew && !this.newStockNotificationShownFor.has(stock.code));
                this.processNewStockNotifications(newStocksForToast);
                this.showStatusUpdateBanner();
            }
            this.nextUpdateSeconds--;
        }, 1000);
      },
      handleRefreshData: function() {
        console.log("Manual refresh: Processing notifications and showing status banner.");
        this.newStockNotificationShownFor.clear();
        AppLogic.applyStockFilters();
        UIRenderer.renderConditionTabs();
        UIRenderer.renderForumPosts();
        UIRenderer.setLastUpdateTime();
        this.nextUpdateSeconds = AppConfig.tickerUpdateIntervalSeconds;
        UIRenderer.updateTimersUI(this.nextUpdateSeconds);
        this.showStatusUpdateBanner();
        const currentNewStocks = MockData.sampleStocks.filter(stock => stock.isNew);
        this.processNewStockNotifications(currentNewStocks);
      },
      handlePageNavigation: function(targetService) {
        const { stockServiceContent, coinServiceContent, navStocksLink, navCoinsLink } = AppConfig.elements;
        if (!stockServiceContent || !coinServiceContent || !navStocksLink || !navCoinsLink) return;

        if (targetService === 'stocks') {
            stockServiceContent.classList.remove('hidden');
            coinServiceContent.classList.add('hidden');
            navStocksLink.classList.add('active'); 
            navCoinsLink.classList.remove('active');
            window.location.hash = 'stocks';
            const activeCategoryTab = AppConfig.elements.stockCategoryTabs.querySelector('.category-tab-btn.tab-active');
            this.currentStockCategory = activeCategoryTab ? activeCategoryTab.dataset.category : 'realtime_news_stocks';
            this.applyStockFilters();

        } else if (targetService === 'coins') {
            stockServiceContent.classList.add('hidden');
            coinServiceContent.classList.remove('hidden');
            navCoinsLink.classList.add('active');
            navStocksLink.classList.remove('active');
            window.location.hash = 'coins';
        }
      },
      initEventListeners: function() {
        if(AppConfig.elements.filterButtonsGroup) AppConfig.elements.filterButtonsGroup.addEventListener('click', this.handleFilterButtonClick.bind(this));
        if(AppConfig.elements.conditionFilterSelect) AppConfig.elements.conditionFilterSelect.addEventListener('change', this.handleConditionFilterChange.bind(this));
        if(AppConfig.elements.stockCardsContainer) AppConfig.elements.stockCardsContainer.addEventListener('click', this.handleFavoriteToggle.bind(this));
        if(AppConfig.elements.conditionTabsNav) AppConfig.elements.conditionTabsNav.addEventListener('click', this.handleTabNavigation.bind(this));
        if(AppConfig.elements.newPostSubmitBtn) AppConfig.elements.newPostSubmitBtn.addEventListener('click', this.handleAddNewPost.bind(this));
        if(AppConfig.elements.refreshDataBtn) AppConfig.elements.refreshDataBtn.addEventListener('click', () => this.handleRefreshData());
        if(AppConfig.elements.notificationToggle) {
            this.notificationsEnabled = AppConfig.elements.notificationToggle.checked;
            AppConfig.elements.notificationToggle.addEventListener('change', (event) => {
                this.notificationsEnabled = event.target.checked;
                if (!this.notificationsEnabled && AppConfig.elements.toastNotification && !AppConfig.elements.toastNotification.classList.contains('hidden')) {
                    AppConfig.elements.toastNotification.classList.remove('opacity-100', 'translate-y-0');
                    AppConfig.elements.toastNotification.classList.add('opacity-0', 'translate-y-10', 'hidden');
                    if(this.toastTimeoutId) clearTimeout(this.toastTimeoutId);
                }
            });
        }
        if(AppConfig.elements.forumPostsContainer) AppConfig.elements.forumPostsContainer.addEventListener('click', (event) => {
            if (event.target.closest('.like-btn')) { AppLogic.handleLikePost(event); }
            else if (event.target.closest('.reply-submit-btn')) { AppLogic.handleAddReply(event); }
        });
        if (AppConfig.elements.stockCategoryTabs) {
            AppConfig.elements.stockCategoryTabs.addEventListener('click', (event) => {
                const tabButton = event.target.closest('.category-tab-btn');
                if (!tabButton || tabButton.classList.contains('tab-active')) return;
                AppConfig.elements.stockCategoryTabs.querySelectorAll('.category-tab-btn').forEach(btn => {
                    btn.classList.remove('tab-active', 'text-white'); btn.classList.add('text-gray-400', 'hover:text-gray-200');
                });
                tabButton.classList.add('tab-active', 'text-white'); tabButton.classList.remove('text-gray-400', 'hover:text-gray-200');
                this.currentStockCategory = tabButton.dataset.category;
                this.applyStockFilters();
            });
        }
        if (AppConfig.elements.navStocksLink) AppConfig.elements.navStocksLink.addEventListener('click', (e) => { e.preventDefault(); AppLogic.handlePageNavigation('stocks'); });
        if (AppConfig.elements.navCoinsLink) AppConfig.elements.navCoinsLink.addEventListener('click', (e) => { e.preventDefault(); AppLogic.handlePageNavigation('coins'); });

        if(AppConfig.elements.loginBtnHeader) AppConfig.elements.loginBtnHeader.addEventListener('click', () => this.toggleModal(AppConfig.elements.loginModal, true));
        if(AppConfig.elements.closeLoginModalBtn) AppConfig.elements.closeLoginModalBtn.addEventListener('click', () => { this.toggleModal(AppConfig.elements.loginModal, false); if(AppConfig.elements.loginFeedback) AppConfig.elements.loginFeedback.textContent = ''; });
        if(AppConfig.elements.loginForm) AppConfig.elements.loginForm.addEventListener('submit', this.handleLogin.bind(this));
        if(AppConfig.elements.signupBtnHeader) AppConfig.elements.signupBtnHeader.addEventListener('click', () => this.toggleModal(AppConfig.elements.signupModal, true));
        if(AppConfig.elements.closeSignupModalBtn) AppConfig.elements.closeSignupModalBtn.addEventListener('click', () => { this.toggleModal(AppConfig.elements.signupModal, false); if(AppConfig.elements.signupIdFeedback) AppConfig.elements.signupIdFeedback.textContent = ''; if(AppConfig.elements.signupPasswordFeedback) AppConfig.elements.signupPasswordFeedback.textContent = ''; });
        if(AppConfig.elements.signupForm) AppConfig.elements.signupForm.addEventListener('submit', this.handleSignup.bind(this));
        if(AppConfig.elements.checkIdDuplicateBtn) AppConfig.elements.checkIdDuplicateBtn.addEventListener('click', this.handleCheckIdDuplicate.bind(this));
        if(AppConfig.elements.logoutBtnHeader) AppConfig.elements.logoutBtnHeader.addEventListener('click', this.handleLogout.bind(this));
      }
    };

    document.addEventListener('DOMContentLoaded', () => {
      UIRenderer.renderTickers();
      AppLogic.checkLoggedInStatus(); 
      AppLogic.initEventListeners();

      const initialPage = window.location.hash.substring(1) || 'stocks';
      AppLogic.handlePageNavigation(initialPage); 
      
      if (initialPage === 'stocks') {
        UIRenderer.populateConditionFilterOptions();
        const activeCategoryTab = AppConfig.elements.stockCategoryTabs.querySelector('.category-tab-btn.tab-active');
        AppLogic.currentStockCategory = activeCategoryTab ? activeCategoryTab.dataset.category : 'realtime_news_stocks';
        AppLogic.applyStockFilters();
        UIRenderer.renderConditionTabs();
        UIRenderer.renderForumPosts();
        UIRenderer.setLastUpdateTime();
        const initialNewStocks = MockData.sampleStocks.filter(stock => stock.isNew && stock.initiallyNew);
        AppLogic.processNewStockNotifications(initialNewStocks);
      }
      AppLogic.startUpdateTimer();
    });
  </script>
</body>
</html>